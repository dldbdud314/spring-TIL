### 프록시

- `em.getReference()`: 데이터베이스 조회를 미루는 가짜 프록시 객체

#### 특징

- 실제 객체의 참조를 보관, 처음 사용할 때 한번만 초기화
- 실제 엔티티를 상속 받아서 모양이 같음 (타입 체크 시 instance of)

### 즉시로딩과 지연로딩

- 주요 문제: A와 B가 연결된 경우, A를 조회할 때 B도 자주 함꼐 사용되는가? 꼭 B도 가져와야 할까?

#### 지연로딩

- A 조회할 때 B는 프록시 객체로, 필요할 떄 실객체 가져옴
- `fetch = FetchType.LAZY` 사용해서 프록시로 조회

#### 즉시로딩

- A랑 B 무조건 묶어서 가져옴
- `fetch = FetchType.EAGER`로 함께 조회

#### 즉시로딩 사용 지양하기 (-> **실무에선 지연로딩만** 쓰자)

- 예상하지 못한 SQL 나가, JPQL에서 N+1 문제 일으킨다
- `@ManyToOne`, `@OneToOne` -> LAZY로 설정 바꾸기 (기본이 즉시 로딩)

### 영속성 전이

- 특정 엔티티를 영속 상태로 만들 때 연관된 엔티티도 함께 영속 상태로 만들고 싶을 때

- 영속성 전이 - 저장의 경우:
  `@OneToMany(mappedBy="parent", cascade=CascadeType.PERSIST)`

- 종류: ALL, PERSIST, REMOVE

- **언제 사용??**
  > 1. 라이프사이클이 똑같은 경우, 2) 단일 소유자일 경우

### 고아 객체

- 고아 객체 제거: 부모 엔티티와 연관관계가 끊어진 자식 엔티티를 자동으로 삭제
- `orphanRemoval = true`

- 주의: 특정 엔티티가 개인 소유할 때만 사용할 것
